# 快速测试指南

## ✅ 已修复的问题

### 1. 设置界面悬浮窗权限请求
**修复内容**：
- 修改了 [SettingsScreen.kt](app/src/main/java/com/yinian/clipboard/ui/screens/SettingsScreen.kt)
- 移除了错误的 `AppCompatActivity` 类型转换
- 直接启动系统设置页面
- 添加了"刷新状态"按钮

### 2. 主界面数据显示
**修复内容**：
- 修改了 [MainScreen.kt](app/src/main/java/com/yinian/clipboard/ui/screens/MainScreen.kt)
- 添加了自动加载数据功能
- 添加了手动刷新按钮
- 显示剪贴板记录数量

---

## 🧪 快速测试步骤

### 测试1：剪贴板监听功能

1. **安装并启动应用**
2. **授予权限**（Android 13+ 会弹出通知权限请求）
3. **复制文本测试**
   ```
   - 在任何应用中复制一段文本（如浏览器、微信等）
   - 等待2-3秒
   - 返回一念剪贴板应用
   ```
4. **检查结果**
   - ✅ 顶部应该显示 "共 X 条"
   - ✅ 列表应该显示刚复制的文本
   - ✅ 点击右上角刷新按钮可以手动更新

### 测试2：悬浮窗功能

1. **切换到设置标签**
2. **请求悬浮窗权限**
   ```
   - 点击"请求权限"按钮
   - 系统会跳转到悬浮窗权限设置页面
   - 开启"一念剪贴板"的悬浮窗权限
   - 返回应用，点击"我已授权"
   ```
3. **刷新权限状态**
   ```
   - 点击"刷新状态"按钮
   - 权限状态应该变为"已授予"
   ```
4. **显示悬浮窗**
   ```
   - 打开"悬浮窗显示"开关
   - 桌面应该出现圆形悬浮窗按钮
   - 可以拖动悬浮窗
   - 点击悬浮窗有响应
   ```

---

## 🐛 如果仍然没有显示

### 检查清单

#### 1. 检查通知栏
- 查看是否有"剪贴板监听服务"的通知
- 如果没有，说明服务未启动

#### 2. 检查权限
- Android 13+：检查通知权限是否授予
- 悬浮窗：检查悬浮窗权限是否授予

#### 3. 手动测试
- 点击主界面右上角的刷新按钮
- 查看顶部显示的记录数量

#### 4. 查看日志
```bash
adb logcat | grep -i clipboard
```

---

## 💡 调试技巧

### 强制重启服务
1. 完全关闭应用
2. 重新打开应用
3. 服务会自动启动

### 清空数据重新测试
1. 系统设置 > 应用 > 一念剪贴板
2. 存储 > 清空数据
3. 重新打开应用

### 检查数据库
```bash
adb shell
run-as com.yinian.clipboard
cd databases
ls -la
```

---

## 📋 已知限制

1. **服务启动延迟**：首次启动可能需要5-10秒
2. **权限检查**：从设置页面返回后需要点击"刷新状态"
3. **去重机制**：2秒内重复复制不会保存

---

## 🎯 下一步优化

如果基础功能正常，可以考虑：
1. 添加时间显示优化（"刚刚"/"X分钟前"）
2. 添加标签系统UI
3. 添加空状态插图
4. 优化悬浮窗图标

---

## 📞 问题反馈

如果测试后仍有问题，请提供：
1. Android 版本
2. 具体操作步骤
3. 预期结果 vs 实际结果
4. Logcat 日志（如有）
