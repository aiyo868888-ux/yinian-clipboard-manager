# Android剪贴板收集应用 - 测试指南

## APK文件位置

```
project/yinian-clipboard-manager/app/build/outputs/apk/debug/app-debug.apk
```

文件大小：17MB | 构建时间：2025-01-17

---

## 安装步骤

### 方法1：通过USB安装（推荐）

```bash
# 1. 启用手机开发者选项和USB调试
# 2. 连接手机到电脑
# 3. 安装APK
adb install project/yinian-clipboard-manager/app/build/outputs/apk/debug/app-debug.apk

# 如果安装失败（已有旧版本），先卸载
adb uninstall com.yinian.clipboard
adb install project/yinian-clipboard-manager/app/build/outputs/apk/debug/app-debug.apk
```

### 方法2：手动安装

1. 将APK文件传输到手机（通过微信、QQ、云盘等）
2. 在手机文件管理器中找到APK文件
3. 点击安装（允许安装未知来源应用）

---

## 权限配置流程

### 步骤1：悬浮窗权限（必需）

1. 打开应用后，点击"开启悬浮窗"
2. 系统会跳转到悬浮窗权限设置
3. 找到"一念剪贴板"，开启开关
4. 返回应用

**验证方法**：屏幕上出现圆形悬浮窗图标

### 步骤2：辅助功能权限（必需，核心功能）

1. 在应用主界面，点击"开启辅助功能"
2. 系统会跳转到辅助功能设置
3. 找到"一念剪贴板"，点击进入
4. 开启辅助功能开关
5. 系统会提示权限说明，点击"允许"

**验证方法**：辅助功能页面显示"已启用"

---

## 功能测试清单

### ✅ 测试1：基本保存流程

**操作步骤**：
1. 复制任意文本（长按文本→复制）
2. 点击屏幕上的圆形悬浮窗
3. 观察：应该显示"已保存"提示

**预期结果**：
- Toast提示"已保存"
- 日志显示：`✅ 已保存[监听缓存]: ...`

**如何查看日志**：
```bash
adb logcat | grep "已保存"
```

---

### ✅ 测试2：时序列表验证

**操作步骤**：
1. 复制文本"A"，点击悬浮窗保存
2. 复制文本"B"，点击悬浮窗保存
3. 复制文本"C"，点击悬浮窗保存
4. 打开应用主界面

**预期结果**：
- 列表显示顺序：C → B → A（最新在最上）
- 每条记录显示时间戳

---

### ✅ 测试3：后台运行验证（重要）

**操作步骤**：
1. 打开微信或其他应用
2. 在微信中复制一段文本
3. 点击悬浮窗
4. 返回一念剪贴板应用

**预期结果**：
- 保存成功，显示在列表顶部
- 微信等应用无影响（悬浮窗未抢焦点）

**验证日志**：
```bash
adb logcat | grep -E "剪贴板已更新|检测到点击事件"
```

---

### ✅ 测试4：悬浮窗拖动测试

**操作步骤**：
1. 长按悬浮窗
2. 拖动到屏幕其他位置
3. 松手

**预期结果**：
- 悬浮窗跟随拖动
- 松手后停留在新位置
- **不会**触发保存（拖动不是点击）

---

### ✅ 测试5：空剪贴板处理

**操作步骤**：
1. 清空剪贴板（复制空格或不复制）
2. 点击悬浮窗

**预期结果**：
- 提示"剪贴板为空，请先复制文本"
- 不会崩溃

---

## 日志监控

### 实时查看关键日志

```bash
# Windows Git Bash
adb logcat | grep -E "Clipboard|FloatingWindow|Accessibility|剪贴板|已保存|点击"

# 过滤特定事件
adb logcat | grep "剪贴板已更新"      # 监听剪贴板变化
adb logcat | grep "检测到点击事件"    # 悬浮窗点击
adb logcat | grep "已保存"            # 保存成功
```

### 正常日志示例

```
✅ 辅助功能服务已启动
📋 初始剪贴板内容: 测试文本...
✅ 初始缓存已更新
📋 剪贴板已更新: 新的测试内容...
👆 检测到点击事件 (deltaX=3.2, deltaY=2.1)
📱 悬浮窗点击：开始保存剪贴板
📦 缓存数据: ClipboardData(type=TEXT, textContent=新的测试内容...)
✅ 准备保存: 新的测试内容...
✅ 已保存[监听缓存]: 新的测试内容...
```

### 异常日志示例

```
❌ 辅助功能服务启动失败        → 辅助功能权限未授予
❌ 悬浮窗权限被拒绝             → 悬浮窗权限未授予
⚠️ 缓存为空，尝试直接读取系统剪贴板  → 辅助功能未启动（应急方案生效）
❌ 读取剪贴板失败               → 权限不足或系统限制
```

---

## 常见问题排查

### 问题1：悬浮窗不显示

**原因**：悬浮窗权限未授予

**解决**：
1. 设置 → 应用管理 → 一念剪贴板 → 权限
2. 开启"悬浮窗权限"
3. 或 设置 → 应用和通知 → 特殊访问 → 悬浮窗 → 一念剪贴板

---

### 问题2：点击悬浮窗无反应

**原因**：辅助功能服务未启动

**解决**：
1. 设置 → 辅助功能 → 一念剪贴板
2. 开启开关
3. 确认显示"已启用"

**验证日志**：
```bash
adb logcat | grep "辅助功能服务已启动"
```

---

### 问题3：保存失败，提示"剪贴板为空"

**原因**：辅助功能未启动，应急方案也无法读取

**解决**：
1. 确保辅助功能已开启
2. 复制一些文本后再尝试
3. 重启应用

---

### 问题4：辅助功能服务自动关闭

**原因**：系统省电策略或安全软件限制

**解决**：
1. 设置 → 电池 → 一念剪贴板 → 关闭省电优化
2. 设置 → 应用管理 → 一念剪贴板 → 自启动 → 开启
3. 将应用加入安全软件白名单（小米、华为等）

**小米/红米设备额外配置**：
1. 安全中心 → 应用管理 → 一念剪贴板
2. 权限 → 读取剪贴板 → 允许
3. 权限 → 后台弹出界面 → 允许
4. 省电策略 → 无限制

**华为/荣耀设备额外配置**：
1. 设置 → 应用和服务 → 权限管理
2. 读取剪贴板 → 允许
3. 电池优化 → 一念剪贴板 → 不允许优化

---

## 性能测试

### 测试内存占用

```bash
# 查看应用内存占用
adb shell dumpsys meminfo com.yinian.clipboard | grep TOTAL
```

**目标**：< 80MB

---

### 测试CPU占用

```bash
# 实时查看CPU使用率
adb shell top | grep com.yinian.clipboard
```

**目标**：后台 < 3%

---

## 兼容性测试

### 推荐测试设备

| 设备类型 | 品牌 | Android版本 | 优先级 |
|---------|------|-----------|--------|
| 原生Android | Google Pixel | 13/14 | 最高 |
| 国产ROM | 小米/红米 | MIUI 14 | 高 |
| 国产ROM | 华为/荣耀 | HarmonyOS 3/4 | 高 |
| 国产ROM | OPPO/vivo | ColorOS/OriginOS | 中 |
| 其他 | Samsung | One UI | 中 |

---

## 卸载方法

### 方法1：通过ADB

```bash
adb uninstall com.yinian.clipboard
```

### 方法2：手机上卸载

1. 设置 → 应用管理 → 一念剪贴板
2. 点击"卸载"
3. 确认卸载

**注意**：卸载前会提示关闭辅助功能权限，按提示操作即可

---

## 下一步

如果测试成功，可以考虑的优化：

1. ✅ 添加震动反馈（点击时）
2. ✅ 优化Toast提示（显示内容预览）
3. ✅ 添加空状态提示
4. ✅ 权限引导页面优化
5. ✅ 重复内容检测
6. ✅ 数据导出功能（已有代码，可增强）

测试完成后，请反馈：
- [ ] 基本保存流程是否正常
- [ ] 后台运行是否稳定
- [ ] 是否有权限问题
- [ ] 设备型号和Android版本
