# 辅助功能服务启动检查清单

## 问题：保存的都是旧内容

### 根本原因
辅助功能服务(ClipboardAccessibilityService)没有启动或没有正常工作。

---

## 检查步骤

### Step 1: 确认辅助功能是否启用

**在华为/荣耀手机上**：
1. 打开"设置"
2. 找到"辅助功能"（可能在"系统和更新"或"智能辅助"里）
3. 查找"一念剪贴板"
4. 点击进入，**确认开关已打开**

**如果找不到"一念剪贴板"**：
- 说明服务没有正确注册到系统
- 需要重新安装应用或检查AndroidManifest.xml

---

### Step 2: 查看启动日志

在Android Studio的Logcat中，确保过滤条件正确：
- 包名过滤：`com.yinian.clipboard`
- 或搜索关键词：`辅助功能服务已启动`

**正常情况下应该看到**：
```
✅ 辅助功能服务已启动
✅ 剪贴板监听器已注册
✅ 广播接收器已注册
📋 初始剪贴板内容: xxx...
✅ 初始缓存已更新
```

**如果看不到这些日志**：
- 辅助功能服务未启动
- 或被系统杀掉了

---

### Step 3: 测试广播触发

1. 复制文本"测试123"
2. 点击悬浮窗
3. 在Logcat中应该看到：
```
📡 收到触发广播，主动读取剪贴板
📋 强制读取剪贴板内容: 测试123...
✅ 缓存已更新[强制读取]
📦 使用辅助功能缓存: 测试123...
✅ 已保存: 测试123...
```

**如果只看到**：
```
📱 悬浮窗点击：开始保存剪贴板
```

但没有后续的"收到触发广播"日志，说明：
- 广播发送失败
- 或辅助功能服务没有接收广播

---

## 可能的原因

### 原因1: 辅助功能未启用
**解决**：在设置中手动开启

### 原因2: 服务被系统杀掉
**解决**：
- 设置 → 应用管理 → 一念剪贴板
- 电池优化 → 选择"不限制"
- 自启动 → 开启

### 原因3: 权限不足
**解决**：检查AndroidManifest.xml中辅助功能权限声明

### 原因4: 服务注册失败
**解决**：卸载应用，重新安装

---

## 临时测试方法

如果辅助功能实在无法使用，可以暂时测试前台功能：

1. **保持应用在前台**
2. 复制文本
3. 点击悬浮窗
4. 应该能正常保存（前台可以直接读取剪贴板）

如果前台也保存旧内容，说明还有其他问题。

---

## 下一步

**请先完成以上检查，然后告诉我**：
1. 辅助功能是否在设置中找到了？
2. 如果找到了，开关是否已打开？
3. Logcat中是否看到"✅ 辅助功能服务已启动"？

根据你的回答，我会提供针对性的解决方案。
